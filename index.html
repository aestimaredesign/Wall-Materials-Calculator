<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wall Materials Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Your CSS remains the same */
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-gray: #ecf0f1;
            --medium-gray: #bdc3c7;
            --dark-gray: #7f8c8d;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .wall-calculator * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        body {
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
        }
        .wall-calculator {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--white);
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            display: flex;
            gap: 30px;
        }
        .calculator-form {
            flex: 2;
            min-width: 0;
        }
        .guidelines {
            flex: 1;
            max-width: 450px;
            background: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }
        .wall-calculator h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 25px;
            font-size: 28px;
            font-weight: 600;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 10px;
        }
        .wall-calculator h2 {
            color: var(--primary-color);
            font-size: 18px;
            font-weight: 600;
            margin: 25px 0 15px;
            border-bottom: 1px solid var(--medium-gray);
            padding-bottom: 8px;
        }
        .wall-calculator h3 {
            color: var(--primary-color);
            font-size: 16px;
            font-weight: 600;
            margin: 20px 0 12px;
        }
        .wall-calculator form {
            display: grid;
            gap: 18px;
        }
        .wall-calculator label {
            display: flex;
            flex-direction: column;
            font-size: 14px;
            font-weight: 500;
            color: var(--primary-color);
        }
        .wall-calculator input, .wall-calculator select {
            padding: 12px;
            margin-top: 6px;
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            font-size: 14px;
            width: 100%;
            box-sizing: border-box;
            transition: all 0.3s;
        }
        .wall-calculator input:focus, .wall-calculator select:focus {
            border-color: var(--secondary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        .download-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .wall-calculator button {
            background-color: var(--secondary-color);
            color: var(--white);
            padding: 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background-color 0.3s;
            width: 100%;
        }
        .wall-calculator button:hover:not(:disabled) {
            background-color: #2980b9;
        }
        .wall-calculator button.secondary {
            background-color: var(--dark-gray);
        }
        .wall-calculator button.secondary:hover {
            background-color: #6c7a89;
        }
        .results {
            margin-top: 25px;
            padding: 20px;
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            background-color: var(--light-gray);
        }
        .error {
            color: var(--accent-color);
            font-weight: 600;
            font-size: 14px;
            background-color: rgba(231, 76, 60, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .success {
            color: var(--success-color);
            font-weight: 600;
            font-size: 14px;
            background-color: rgba(39, 174, 96, 0.1);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .results p {
            margin: 10px 0;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
        }
        .results p strong {
            color: var(--primary-color);
            min-width: 200px;
            font-weight: 600;
        }
        .results .value {
            text-align: right;
            font-weight: 500;
        }
        .guidelines p, .guidelines li {
            font-size: 14px;
            color: var(--primary-color);
            line-height: 1.6;
        }
        .guidelines .formula {
            font-family: 'Courier New', Courier, monospace;
            background: var(--white);
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: 6px;
            margin: 8px 0;
            display: inline-block;
            font-size: 13px;
        }
        .note {
            font-size: 14px;
            color: var(--dark-gray);
            margin: 12px 0;
            font-style: italic;
        }
        .cost-summary {
            margin-top: 20px;
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }
        .cost-summary table {
            width: 100%;
            border-collapse: collapse;
        }
        .cost-summary th {
            background-color: var(--primary-color);
            color: var(--white);
            padding: 12px;
            text-align: left;
        }
        .cost-summary td {
            padding: 12px;
            border-bottom: 1px solid var(--medium-gray);
        }
        .cost-summary tr:last-child td {
            border-bottom: none;
            font-weight: 600;
            background-color: rgba(44, 62, 80, 0.05);
        }
        .cost-summary .cost-value {
            text-align: right;
            font-weight: 600;
        }
        .material-card {
            background: var(--light-gray);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary-color);
        }
        .material-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .remove-material {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }
        .add-material-btn {
            background: var(--success-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .accessory-section {
            background: rgba(236, 240, 241, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 3px solid var(--warning-color);
        }
        .toggle-section {
            display: flex;
            align-items: center;
            cursor: pointer;
            margin-bottom: 10px;
        }
        .toggle-icon {
            margin-right: 10px;
            font-weight: bold;
            transition: transform 0.3s;
        }
        .toggle-section.active .toggle-icon {
            transform: rotate(90deg);
        }
        .section-content {
            display: none;
        }
        .section-content.visible {
            display: block;
        }
        @media (max-width: 1000px) {
            .wall-calculator {
                flex-direction: column;
                margin: 10px;
                padding: 20px;
            }
            .calculator-form, .guidelines {
                max-width: 100%;
            }
            .download-buttons {
                flex-direction: column;
            }
            .wall-calculator button {
                width: 100%;
            }
        }
        .tab-container {
            display: flex;
            border-bottom: 1px solid var(--medium-gray);
            margin-bottom: 20px;
        }
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 500;
            color: var(--dark-gray);
            border-bottom: 3px solid transparent;
        }
        .tab.active {
            color: var(--secondary-color);
            border-bottom: 3px solid var(--secondary-color);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .framed-wall-options .plies-label input {
            width: 80px;
        }
        .side-selection {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        .side-box {
            border: 1px solid var(--medium-gray);
            padding: 15px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.7);
        }
        .side-box label {
            margin-bottom: 10px;
        }
        .formula-box {
            background-color: #f8f9fa;
            border-left: 4px solid var(--secondary-color);
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .formula-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        .formula-item {
            margin: 8px 0;
            padding-left: 15px;
            position: relative;
        }
        .formula-item:before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--secondary-color);
        }
        .cost-per-sqm {
            font-size: 12px;
            color: var(--dark-gray);
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="wall-calculator">
        <div class="calculator-form">
            <h1>Wall Materials Calculator</h1>
            <form id="calculatorForm">
                <div class="tab-container">
                    <div class="tab active" data-tab="project">Project Info</div>
                    <div class="tab" data-tab="materials">Materials</div>
                    <div class="tab" data-tab="costs">Costs</div>
                </div>
                <div class="tab-content active" id="project-tab">
                    <h2>Project Information</h2>
                    <label>Project Name: <input type="text" id="projectName" value="Office Renovation" title="Name of the project" required></label>
                    <label>Project Location: <input type="text" id="projectLocation" value="Manila" title="Location of the project" required></label>
                    <label>Client Name: <input type="text" id="clientName" value="John Dela Cruz" title="Name of the client" required></label>
                    <label>Company Name: <input type="text" id="companyName" value="Quality Builders Inc." title="Name of the company" required></label>
                    <label>Date: <input type="date" id="date" value="2025-09-15" title="Date of estimation" required></label>
                    <label>Prepared By: <input type="text" id="preparedBy" value="Maria Santos" title="Name of the estimator" required></label>
                    <h2>Wall Parameters</h2>
                    <label>Length (m): <input type="number" id="length" step="0.01" min="0.01" value="10" title="Length of the wall in meters" required></label>
                    <label>Height (m): <input type="number" id="height" step="0.01" min="0.01" value="3" title="Height of the wall in meters" required></label>
                    <label>Door Area (m²): <input type="number" id="doorArea" step="0.01" min="0" value="0" title="Total area of doors" required></label>
                    <label>Window Area (m²): <input type="number" id="windowArea" step="0.01" min="0" value="0" title="Total area of windows" required></label>
                </div>
                <div class="tab-content" id="materials-tab">
                    <h2>Material Layers</h2>
                    <div id="materials-container"></div>
                    <button type="button" class="add-material-btn" onclick="addMaterial()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="fill: white;"><path d="M12 4C11.4477 4 11 4.44772 11 5V11H5C4.44772 11 4 11.4477 4 12C4 12.5523 4.44772 13 5 13H11V19C11 19.5523 11.4477 20 12 20C12.5523 20 13 19.5523 13 19V13H19C19.5523 13 20 12.5523 20 12C20 11.4477 19.5523 11 19 11H13V5C13 4.44772 12.5523 4 12 4Z"/></svg>
                        Add Material Layer
                    </button>
                    <div class="accessory-section">
                        <div class="toggle-section" onclick="toggleSection('plasteringOptions')">
                            <span class="toggle-icon">►</span>
                            <h3>Plastering Options</h3>
                        </div>
                        <div class="section-content" id="plasteringOptions">
                            <label>Plastering on Side 1: <input type="checkbox" id="plasterSide1" title="Apply plastering to the first side"></label>
                            <label>Plastering on Side 2: <input type="checkbox" id="plasterSide2" title="Apply plastering to the second side"></label>
                            <label>Plastering Thickness (mm): <input type="number" id="plasterThickness" value="10" min="0" step="1" title="Thickness of the plaster in millimeters"></label>
                        </div>
                    </div>
                </div>
                <div class="tab-content" id="costs-tab">
                    <h2>Cost Parameters</h2>
                    <label>Currency:
                        <select id="currency" title="Select the currency for cost estimation">
                            <option value="PHP">PHP (₱)</option>
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (€)</option>
                            <option value="JPY">JPY (¥)</option>
                        </select>
                    </label>
                    <div class="toggle-section" onclick="toggleSection('mainMaterialCosts')">
                        <span class="toggle-icon">►</span>
                        <h3>Main Material Costs</h3>
                    </div>
                    <div class="section-content" id="mainMaterialCosts">
                        <p class="note">Note: Individual material costs are set in the Materials tab</p>
                    </div>
                    <div class="toggle-section" onclick="toggleSection('framingCosts')">
                        <span class="toggle-icon">►</span>
                        <h3>Framing & Support Costs</h3>
                    </div>
                    <div class="section-content" id="framingCosts">
                        <label>Stud Cost (per m): <input type="number" id="studCost" step="0.01" min="0" value="150" title="Cost per meter of stud"></label>
                        <label>Track Cost (per m): <input type="number" id="trackCost" step="0.01" min="0" value="120" title="Cost per meter of track"></label>
                        <label>Screw Cost (per piece): <input type="number" id="screwCost" step="0.01" min="0" value="1.5" title="Cost per piece of screw"></label>
                        <label>Joint Compound Cost (per kg): <input type="number" id="jointCompoundCost" step="0.01" min="0" value="50" title="Cost per kg of joint compound"></label>
                        <label>Sealant Cost (per tube): <input type="number" id="sealantCost" step="0.01" min="0" value="200" title="Cost per tube of sealant"></label>
                        <label>Rebar Cost (per m): <input type="number" id="rebarCost" step="0.01" min="0" value="80" title="Cost per meter of rebar"></label>
                        <label>Connector Cost (per piece): <input type="number" id="connectorCost" step="0.01" min="0" value="50" title="Cost per piece of connector"></label>
                    </div>
                    <div class="toggle-section" onclick="toggleSection('mortarCosts')">
                        <span class="toggle-icon">►</span>
                        <h3>Mortar & Plastering Costs</h3>
                    </div>
                    <div class="section-content" id="mortarCosts">
                        <label>Mortar Cement Cost (per bag): <input type="number" id="mortarCementCost" step="0.01" min="0" value="250" title="Cost per 40kg bag of cement for mortar"></label>
                        <label>Mortar Sand Cost (per ton): <input type="number" id="mortarSandCost" step="0.01" min="0" value="1000" title="Cost per ton of sand for mortar"></label>
                        <label>Mortar Water Cost (per m³): <input type="number" id="mortarWaterCost" step="0.01" min="0" value="50" title="Cost per cubic meter of water for mortar"></label>
                        <label>Plastering Cement Cost (per bag): <input type="number" id="plasterCementCost" step="0.01" min="0" value="250" title="Cost per 40kg bag of cement for plastering"></label>
                        <label>Plastering Sand Cost (per ton): <input type="number" id="plasterSandCost" step="0.01" min="0" value="1000" title="Cost per ton of sand for plastering"></label>
                        <label>Plastering Water Cost (per m³): <input type="number" id="plasterWaterCost" step="0.01" min="0" value="50" title="Cost per cubic meter of water for plastering"></label>
                    </div>
                    <div class="toggle-section" onclick="toggleSection('laborContingencyCosts')">
                        <span class="toggle-icon">►</span>
                        <h3>Labor & Contingency Costs</h3>
                    </div>
                    <div class="section-content" id="laborContingencyCosts">
                        <label>Labor Cost (per m²): <input type="number" id="laborCost" step="0.01" min="0" value="350" title="Cost of labor per square meter of wall area"></label>
                        <label>Number of Laborers: <input type="number" id="laborers" step="1" min="1" value="4" title="Number of laborers for the project" required></label>
                        <label>Contingency (%): <input type="number" id="contingency" step="1" min="0" max="20" value="10" title="Percentage for unexpected costs" required></label>
                        <label>Preparation Time (days): <input type="number" id="prepTime" step="0.01" min="0" value="0.5" title="Preparation time in days" required></label>
                        <label>Cleanup Time (days): <input type="number" id="cleanupTime" step="0.01" min="0" value="0.5" title="Cleanup time in days" required></label>
                    </div>
                    <div class="toggle-section" onclick="toggleSection('additionalCosts')">
                        <span class="toggle-icon">►</span>
                        <h3>Additional Costs</h3>
                    </div>
                    <div class="section-content" id="additionalCosts">
                        <label>Overhead (%): <input type="number" id="overheadPercent" step="1" min="0" max="100" value="0" title="Overhead percentage" required></label>
                        <label>Equipment (%): <input type="number" id="equipmentPercent" step="1" min="0" max="100" value="0" title="Equipment percentage" required></label>
                        <label>Profit Margin (%): <input type="number" id="profitMargin" step="1" min="0" max="100" value="0" title="Profit margin percentage" required></label>
                    </div>
                </div>
                <button type="submit" id="calculateButton">Calculate</button>
            </form>
            <div id="results" class="results" style="display:none;">
                <h2>Calculation Results</h2>
                <div id="message"></div>
                <h3>Wall Parameters</h3>
                <p><strong>Length:</strong> <span class="value" id="wallLengthResult"></span></p>
                <p><strong>Height:</strong> <span class="value" id="wallHeightResult"></span></p>
                <p><strong>Door Area:</strong> <span class="value" id="doorAreaResult"></span></p>
                <p><strong>Window Area:</strong> <span class="value" id="windowAreaResult"></span></p>
                <p><strong>Wall Area:</strong> <span class="value" id="wallArea"></span></p>
                <div id="materialResults"></div>
                <h3>Accessory Materials</h3>
                <div id="accessoryResults"></div>
                <div id="plasteringResultsContainer">
                    <h3>Plastering Materials</h3>
                    <div id="plasteringResults"></div>
                </div>
                <h3>Labor Details</h3>
                <p><strong>Number of Laborers:</strong> <span class="value" id="laborersResult"></span></p>
                <p><strong>Productivity Rate:</strong> <span class="value" id="productivityRate"></span></p>
                <p><strong>Preparation Time:</strong> <span class="value" id="prepTimeResult"></span></p>
                <p><strong>Installation Time:</strong> <span class="value" id="installTime"></span></p>
                <p><strong>Cleanup Time:</strong> <span class="value" id="cleanupTimeResult"></span></p>
                <p><strong>Total Project Duration:</strong> <span class="value" id="totalDays"></span></p>
                <div class="cost-summary">
                    <h3>Cost Summary</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Item</th>
                                <th class="cost-value">Cost</th>
                                <th class="cost-value">Cost per m²</th>
                            </tr>
                        </thead>
                        <tbody id="costTableBody">
                            <tr>
                                <td>Main Material Cost</td>
                                <td class="cost-value"><span id="currencySymbolMaterial"></span><span id="materialCostResult"></span></td>
                                <td class="cost-value"><span id="currencySymbolMaterialSqm"></span><span id="materialCostSqm"></span></td>
                            </tr>
                            <tr>
                                <td>Accessory Cost</td>
                                <td class="cost-value"><span id="currencySymbolAccessory"></span><span id="accessoryCostResult"></span></td>
                                <td class="cost-value"><span id="currencySymbolAccessorySqm"></span><span id="accessoryCostSqm"></span></td>
                            </tr>
                            <tr id="plasteringCostRow">
                                <td>Plastering Cost</td>
                                <td class="cost-value"><span id="currencySymbolPlaster"></span><span id="plasteringCostResult"></span></td>
                                <td class="cost-value"><span id="currencySymbolPlasterSqm"></span><span id="plasteringCostSqm"></span></td>
                            </tr>
                            <tr>
                                <td>Labor Cost</td>
                                <td class="cost-value"><span id="currencySymbolLabor"></span><span id="laborCostResult"></span></td>
                                <td class="cost-value"><span id="currencySymbolLaborSqm"></span><span id="laborCostSqm"></span></td>
                            </tr>
                            <tr id="contingencyCostRow">
                                <td>Contingency Cost</td>
                                <td class="cost-value"><span id="currencySymbolContingency"></span><span id="contingencyCostResult"></span></td>
                                <td class="cost-value"><span id="currencySymbolContingencySqm"></span><span id="contingencyCostSqm"></span></td>
                            </tr>
                                                        <tr>
                                <td>Overhead Cost</td>
                                <td class="cost-value"><span id="currencySymbolOverhead"></span><span id="overheadCostResult"></span></td>
                                <td class="cost-value"><span id="currencySymbolOverheadSqm"></span><span id="overheadCostSqm"></span></td>
                            </tr>
                            <tr>
                                <td>Equipment Cost</td>
                                <td class="cost-value"><span id="currencySymbolEquipment"></span><span id="equipmentCostResult"></span></td>
                                <td class="cost-value"><span id="currencySymbolEquipmentSqm"></span><span id="equipmentCostSqm"></span></td>
                            </tr>
                            <tr>
                                <td>Profit Cost</td>
                                <td class="cost-value"><span id="currencySymbolProfit"></span><span id="profitCostResult"></span></td>
                                <td class="cost-value"><span id="currencySymbolProfitSqm"></span><span id="profitCostSqm"></span></td>
                            </tr>
                            <tr>
                                <td>Total Cost</td>
                                <td class="cost-value"><span id="currencySymbolTotal"></span><span id="totalCost"></span></td>
                                <td class="cost-value"><span id="currencySymbolTotalSqm"></span><span id="totalCostSqm"></span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="download-buttons">
                    <button onclick="downloadPDF()">Download as PDF</button>
                </div>
            </div>
        </div>
        <div class="guidelines">
            <h2>Guidelines & Formulas</h2>
            <p>This calculator estimates the materials and costs for constructing a wall based on the provided parameters. The formulas used are standard industry estimations.</p>
            <div class="formula-box">
                <div class="formula-title">Wall Area & Material Quantity:</div>
                <div class="formula-item">Wall Area = (Length × Height) - (Door Area + Window Area)</div>
                <div class="formula-item">Material Quantity = Ceiling(Wall Area / Unit Area of Material) × (1 + Waste Factor%)</div>
            </div>
            <div class="formula-box">
                <div class="formula-title">Accessories for Panel Systems:</div>
                <div class="formula-item">Studs = Ceiling(Length / 0.6) × Height × Plies</div>
                <div class="formula-item">Tracks = 2 × Length × Plies</div>
                <div class="formula-item">Screws = Ceiling(Wall Area × 25) × Plies</div>
                <div class="formula-item">Joint Compound = Wall Area × 0.5 × Plies</div>
                <div class="formula-item">Sealant = Length × 0.1</div>
                <div class="formula-item">Connectors = Ceiling(Wall Area / 2)</div>
            </div>
            <div class="formula-box">
                <div class="formula-title">Accessories for Masonry Systems:</div>
                <div class="formula-item">Mortar Volume = Wall Area × 0.01</div>
                <div class="formula-item">Mortar Cement Bags = Ceiling(Mortar Volume × 0.25 / 0.025 × (1 + Waste Factor%))</div>
                <div class="formula-item">Mortar Sand Tons = Mortar Volume × 0.75 × 1.6 × (1 + Waste Factor%)</div>
                <div class="formula-item">Mortar Water = Mortar Volume × 0.5</div>
                <div class="formula-item">Rebar Length = Wall Area × 0.1</div>
            </div>
            <div class="formula-box">
                <div class="formula-title">Labor Estimation:</div>
                <div class="formula-item">Installation Days = Wall Area / Productivity Rate</div>
                <div class="formula-item">Total Days = (Preparation Days + Installation Days + Cleanup Days) / Number of Laborers</div>
            </div>
            <div class="formula-box">
                <div class="formula-title">Cost Estimation:</div>
                <div class="formula-item">Material Cost = Σ(Material Quantity × Cost per Unit)</div>
                <div class="formula-item">Accessory Cost = Σ(Accessory Quantity × Cost per Unit)</div>
                <div class="formula-item">Plastering Cost = (Plaster Cement Bags × Cost per Bag) + (Plaster Sand Tons × Cost per Ton)</div>
                <div class="formula-item">Labor Cost = Wall Area × Labor Cost per m²</div>
                <div class="formula-item">Contingency Cost = (Material Cost + Accessory Cost + Plastering Cost + Labor Cost) × Contingency%</div>
                <div class="formula-item">Overhead Cost = (Base Costs) × Overhead%</div>
                <div class="formula-item">Equipment Cost = (Base Costs) × Equipment%</div>
                <div class="formula-item">Profit Cost = (Base Costs + Contingency + Overhead + Equipment) × Profit Margin%</div>
                <div class="formula-item">Total Cost = Material Cost + Accessory Cost + Plastering Cost + Labor Cost + Contingency Cost + Overhead Cost + Equipment Cost + Profit Cost</div>
            </div>
        </div>
    </div>
    <script>
        let resultsData = null;
    let materialCount = 0;
    const materialConfig = {
        'gypsum': { name: 'Gypsum Board', types: ['Ordinary', 'Moisture-Resistant', 'Fire-Resistant', 'Acoustic', 'Impact-Resistant'], thicknesses: ['9', '12', '15', '16'], dimensions: ['1200 x 2400 mm', '1200 x 3000 mm'], unit: 'panels', unitArea: 2.88, needsPlastering: false, productivityRate: 12, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'fiber-cement': { name: 'Fiber Cement Board', types: ['Ordinary', 'Moisture-Resistant', 'Exterior Grade'], thicknesses: ['4.5', '6', '9', '12', '16'], dimensions: ['1200 x 2400 mm', '1200 x 3000 mm'], unit: 'panels', unitArea: 2.88, needsPlastering: false, productivityRate: 10, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'cement-board': { name: 'Cement Board', types: ['Standard Tile Backer', 'Moisture/Mold Resistant', 'Heavy-Duty'], thicknesses: ['6', '9', '12', '16'], dimensions: ['1200 x 2400 mm'], unit: 'panels', unitArea: 2.88, needsPlastering: false, productivityRate: 9, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'calcium-silicate': { name: 'Calcium Silicate Board', types: ['Standard', 'Moisture-Resistant', 'Fire-Resistant', 'Acoustic'], thicknesses: ['6', '9', '12', '15'], dimensions: ['1200 x 2400 mm', '600 x 1200 mm'], unit: 'panels', unitArea: 2.88, needsPlastering: false, productivityRate: 11, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'mgo': { name: 'Magnesium Oxide Board', types: ['Standard', 'Moisture/Mold-Resistant', 'Fire Resistant'], thicknesses: ['6', '9', '12', '15'], dimensions: ['1200 x 2400 mm'], unit: 'panels', unitArea: 2.88, needsPlastering: false, productivityRate: 10, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'plywood': { name: 'Plywood', types: ['Interior Grade', 'Marine Plywood', 'Phenolic Film-Faced', 'Acoustic'], thicknesses: ['3', '6', '9', '12', '15', '18', '25'], dimensions: ['1220 x 2440 mm'], unit: 'sheets', unitArea: 2.9768, needsPlastering: false, productivityRate: 15, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'mdf': { name: 'MDF', types: ['Standard MDF', 'Moisture-Resistant MDF', 'Fire-Retardant MDF'], thicknesses: ['3', '6', '9', '12', '15', '18', '25'], dimensions: ['1220 x 2440 mm'], unit: 'sheets', unitArea: 2.9768, needsPlastering: false, productivityRate: 14, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'particle-board': { name: 'Particle Board', types: ['Standard', 'Laminated', 'Moisture-Resistant'], thicknesses: ['9', '12', '15', '18'], dimensions: ['1220 x 2440 mm'], unit: 'sheets', unitArea: 2.9768, needsPlastering: false, productivityRate: 13, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'osb': { name: 'OSB', types: ['Standard', 'Exterior Grade', 'Fire-Resistant'], thicknesses: ['9', '12', '15', '18'], dimensions: ['1220 x 2440 mm'], unit: 'sheets', unitArea: 2.9768, needsPlastering: false, productivityRate: 12, accessories: { studs: true, tracks: true, screws: true, jointCompound: true, sealants: false, mortar: false, rebars: false, connectors: false }, supportsPlies: true, isBoard: true, isFramedWall: true },
        'chb': { name: 'Concrete Hollow Block', types: ['4-inch', '6-inch'], thicknesses: ['100', '150'], unit: 'pieces', unitArea: 0.12, needsPlastering: true, productivityRate: 8, accessories: { studs: false, tracks: false, screws: false, jointCompound: false, sealants: false, mortar: true, rebars: true, connectors: true }, supportsPlies: false, isBoard: false, isFramedWall: false },
        'sips': { name: 'Structural Insulated Panels (SIPs)', types: ['Standard', 'High Insulation', 'Fire Resistant'], thicknesses: ['100', '150', '200'], dimensions: ['1200 x 2400 mm', '1200 x 3000 mm'], unit: 'panels', unitArea: 2.88, needsPlastering: false, productivityRate: 15, accessories: { studs: false, tracks: false, screws: true, jointCompound: true, sealants: true, mortar: false, rebars: false, connectors: true }, supportsPlies: false, isBoard: true, isFramedWall: false },
        'aac': { name: 'Autoclaved Aerated Concrete (AAC)', types: ['Standard Block', 'Reinforced Block'], thicknesses: ['100', '150', '200'], unit: 'blocks', unitArea: 0.12, needsPlastering: true, productivityRate: 7, accessories: { studs: false, tracks: false, screws: false, jointCompound: false, sealants: false, mortar: true, rebars: true, connectors: true }, supportsPlies: false, isBoard: false, isFramedWall: false },
        'precast': { name: 'Precast Concrete Wall', types: ['Standard Panel', 'Insulated Panel', 'Decorative'], thicknesses: ['100', '150', '200'], dimensions: ['1200 x 3000 mm'], unit: 'panels', unitArea: 3.6, needsPlastering: false, productivityRate: 20, accessories: { studs: false, tracks: false, screws: false, jointCompound: false, sealants: true, mortar: false, rebars: false, connectors: true }, supportsPlies: false, isBoard: true, isFramedWall: false }
    };
    document.addEventListener('DOMContentLoaded', () => {
        console.log('DOM loaded, initializing calculator');
        // Initialize tabs
        initTabs();
        const form = document.getElementById('calculatorForm');
        if (!form) {
            console.error('Form element not found');
            displayError('Internal error: Form not found');
            return;
        }
        form.addEventListener('submit', calculateResults);
        // Add one material layer on page load
        addMaterial();
    });
    function initTabs() {
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
    }
    // Added this function to handle dynamic updates on the materials tab
    function updateMaterialOptions(materialSelect) {
        const materialCard = materialSelect.closest('.material-card');
        const materialId = materialSelect.id.replace('materialType', '');
        const selectedMaterial = materialConfig[materialSelect.value];
        const boardTypeSelect = materialCard.querySelector(`#boardType${materialId}`);
        const thicknessSelect = materialCard.querySelector(`#thickness${materialId}`);
        const dimensionsSelect = materialCard.querySelector(`#dimensions${materialId}`);
        const wasteFactorInput = materialCard.querySelector(`#wasteFactor${materialId}`);
        const framedWallOptions = materialCard.querySelector('.framed-wall-options');
        // Clear previous options
        boardTypeSelect.innerHTML = '';
        thicknessSelect.innerHTML = '';
        dimensionsSelect.innerHTML = '';
        // Hide framed wall options for non-framed walls
        if (selectedMaterial.isFramedWall) {
            framedWallOptions.style.display = 'block';
        } else {
            framedWallOptions.style.display = 'none';
        }
        // Populate new options based on material config
        if (selectedMaterial.types) {
            selectedMaterial.types.forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                boardTypeSelect.appendChild(option);
            });
        }
        if (selectedMaterial.thicknesses) {
            selectedMaterial.thicknesses.forEach(thickness => {
                const option = document.createElement('option');
                option.value = thickness;
                option.textContent = thickness;
                thicknessSelect.appendChild(option);
            });
        }
        if (selectedMaterial.dimensions) {
            selectedMaterial.dimensions.forEach(dim => {
                const option = document.createElement('option');
                option.value = dim;
                option.textContent = dim;
                dimensionsSelect.appendChild(option);
            });
        }
        // Set waste factor
        wasteFactorInput.value = (selectedMaterial.needsPlastering ? 10 : 5).toFixed(2);
    }
    function addMaterial() {
        materialCount++;
        const materialsContainer = document.getElementById('materials-container');
        const materialCard = document.createElement('div');
        materialCard.className = 'material-card';
        materialCard.id = `material-card-${materialCount}`;
        const materialSelectOptions = Object.keys(materialConfig).map(key => `<option value="${key}">${materialConfig[key].name}</option>`).join('');
        materialCard.innerHTML = `
            <div class="material-header">
                <h3>Material Layer ${materialCount}</h3>
                <button type="button" class="remove-material" onclick="removeMaterial(${materialCount})">Remove</button>
            </div>
            <label>
                Material Type:
                <select id="materialType${materialCount}" class="material-type-select" title="Select the type of material">
                    ${materialSelectOptions}
                </select>
            </label>
            <label>
                Board Type:
                <select id="boardType${materialCount}" title="Select the specific board type"></select>
            </label>
            <label>
                Thickness (mm):
                <select id="thickness${materialCount}" title="Select the material thickness"></select>
            </label>
            <label>
                Dimensions:
                <select id="dimensions${materialCount}" title="Select the material dimensions"></select>
            </label>
            <label>
                Material Cost (per unit):
                <input type="number" id="materialCost${materialCount}" step="0.01" min="0" value="300" title="Cost of one unit of this material" required>
            </label>
            <label>
                Waste Factor (%):
                <input type="number" id="wasteFactor${materialCount}" step="0.01" min="0" max="20" value="${(materialConfig[Object.keys(materialConfig)[0]].needsPlastering ? 10 : 5).toFixed(2)}" title="Waste percentage for this material" required>
            </label>
            <div class="framed-wall-options">
                <div class="side-selection" id="sideSelection${materialCount}">
                    <div class="side-box">
                        <label>
                            Side 1:
                            <input type="checkbox" id="side1${materialCount}" title="Apply this material to the first side">
                        </label>
                        <label class="plies-label">
                            Plies for Side 1:
                            <input type="number" id="pliesSide1${materialCount}" min="1" step="1" value="1" title="Number of layers for Side 1" required>
                        </label>
                    </div>
                    <div class="side-box">
                        <label>
                            Side 2:
                            <input type="checkbox" id="side2${materialCount}" title="Apply this material to the second side">
                        </label>
                        <label class="plies-label">
                            Plies for Side 2:
                            <input type="number" id="pliesSide2${materialCount}" min="1" step="1" value="1" title="Number of layers for Side 2" required>
                        </label>
                    </div>
                </div>
            </div>
        `;
        materialsContainer.appendChild(materialCard);
        // Add event listener for the newly created material select
        const newMaterialSelect = materialCard.querySelector(`#materialType${materialCount}`);
        newMaterialSelect.addEventListener('change', () => updateMaterialOptions(newMaterialSelect));
        // Initialize options for the new material card
        updateMaterialOptions(newMaterialSelect);
    }
    function removeMaterial(id) {
        const materialCard = document.getElementById(`material-card-${id}`);
        if (materialCard) {
            materialCard.remove();
        }
    }
    // Added a helper function to safely divide numbers
    function safeDivide(value, divisor) {
        return parseFloat(value) && parseFloat(divisor) > 0 ? (parseFloat(value) / parseFloat(divisor)).toFixed(2) : '0.00';
    }
    // Added a function to handle toggling sections in the Cost tab
    function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        const toggleBtn = section.previousElementSibling;
        toggleBtn.classList.toggle('active');
        section.classList.toggle('visible');
    }
    function calculateResults(event) {
        event.preventDefault();
        const form = event.target;
        const resultsDiv = document.getElementById('results');
        const messageDiv = document.getElementById('message');
        const currencySymbol = getCurrencySymbol(document.getElementById('currency').value);
        // Get input values and fix invalid ids
        const length = parseFloat(form.length.value);
        const height = parseFloat(form.height.value);
        const doorArea = parseFloat(form.doorArea.value);
        // Corrected ID from "window Area" to "windowArea"
        const windowArea = parseFloat(document.getElementById('windowArea').value);
        // Corrected ID from "plaster Thickness" to "plasterThickness"
        const plasteringThickness = parseFloat(document.getElementById('plasterThickness').value);
        const plasterSide1 = document.getElementById('plasterSide1').checked;
        const plasterSide2 = document.getElementById('plasterSide2').checked;
        const studsCost = parseFloat(form.studCost.value);
        const trackCost = parseFloat(form.trackCost.value);
        const screwCost = parseFloat(form.screwCost.value);
        const jointCompoundCost = parseFloat(form.jointCompoundCost.value);
        const sealantCost = parseFloat(form.sealantCost.value);
        const rebarCost = parseFloat(form.rebarCost.value);
        const connectorCost = parseFloat(form.connectorCost.value);
        const mortarCementCost = parseFloat(form.mortarCementCost.value);
        const mortarSandCost = parseFloat(form.mortarSandCost.value);
        const mortarWaterCost = parseFloat(form.mortarWaterCost.value);
        const plasteringCementCost = parseFloat(form.plasterCementCost.value);
        const plasteringSandCost = parseFloat(form.plasterSandCost.value);
        const plasteringWaterCost = parseFloat(form.plasterWaterCost.value);
        const laborCostPerSqm = parseFloat(form.laborCost.value);
        const laborers = parseFloat(form.laborers.value);
        const contingency = parseFloat(form.contingency.value);
        const prepTime = parseFloat(form.prepTime.value);
        const cleanupTime = parseFloat(form.cleanupTime.value);
        const overheadPercent = parseFloat(form.overheadPercent.value);
        const equipmentPercent = parseFloat(form.equipmentPercent.value);
        const profitMargin = parseFloat(form.profitMargin.value);
        // Calculations based on provided formulas in the Guidelines section
        const wallArea = Math.max(0, (length * height) - (doorArea + windowArea));
        let totalMaterialCost = 0;
        let totalAccessoryCost = 0;
        let totalProductivityRate = 0;
        let materialResultsHtml = '';
        document.querySelectorAll('.material-card').forEach(materialCard => {
            const materialId = materialCard.id.replace('material-card-', '');
            const materialType = document.getElementById(`materialType${materialId}`).value;
            const materialUnitCost = parseFloat(document.getElementById(`materialCost${materialId}`).value);
            const wasteFactor = parseFloat(document.getElementById(`wasteFactor${materialId}`).value) / 100;
            const side1Checked = document.getElementById(`side1${materialId}`).checked;
            const side2Checked = document.getElementById(`side2${materialId}`).checked;
            const pliesSide1 = side1Checked ? parseInt(document.getElementById(`pliesSide1${materialId}`).value) : 0;
            const pliesSide2 = side2Checked ? parseInt(document.getElementById(`pliesSide2${materialId}`).value) : 0;
            const totalPlies = pliesSide1 + pliesSide2;
            const config = materialConfig[materialType];
            const unitArea = config.unitArea;
            const materialQuantity = Math.ceil(wallArea / unitArea) * (1 + wasteFactor) * totalPlies;
            const materialCost = materialQuantity * materialUnitCost;
            totalMaterialCost += materialCost;
            totalProductivityRate += config.productivityRate * totalPlies;
            let accessoriesCost = 0;
            let accessoriesHtml = '';
            if (config.isFramedWall) {
                const studQuantity = Math.ceil(length / 0.6) * height * totalPlies;
                const trackQuantity = 2 * length * totalPlies;
                const screwQuantity = Math.ceil(wallArea * 25) * totalPlies;
                const jointCompoundQuantity = wallArea * 0.5 * totalPlies;
                const sealantQuantity = length * 0.1;
                const connectorQuantity = Math.ceil(wallArea / 2);
                accessoriesCost += (studQuantity * studsCost) + (trackQuantity * trackCost) + (screwQuantity * screwCost) + (jointCompoundQuantity * jointCompoundCost) + (sealantQuantity * sealantCost) + (connectorQuantity * connectorCost);
                accessoriesHtml = `
                    <p><strong>Studs:</strong> <span class="value">${studQuantity.toFixed(2)} m</span></p>
                    <p><strong>Tracks:</strong> <span class="value">${trackQuantity.toFixed(2)} m</span></p>
                    <p><strong>Screws:</strong> <span class="value">${screwQuantity.toFixed(2)} pcs</span></p>
                    <p><strong>Joint Compound:</strong> <span class="value">${jointCompoundQuantity.toFixed(2)} kg</span></p>
                    <p><strong>Sealant:</strong> <span class="value">${sealantQuantity.toFixed(2)} tubes</span></p>
                    <p><strong>Connectors:</strong> <span class="value">${connectorQuantity.toFixed(2)} pcs</span></p>
                `;
            } else {
                const mortarVolume = wallArea * 0.01;
                const mortarCementBags = Math.ceil(mortarVolume * 0.25 / 0.025 * (1 + wasteFactor));
                const mortarSandTons = mortarVolume * 0.75 * 1.6 * (1 + wasteFactor);
                const mortarWater = mortarVolume * 0.5;
                const rebarLength = wallArea * 0.1;
                accessoriesCost += (mortarCementBags * mortarCementCost) + (mortarSandTons * mortarSandCost) + (mortarWater * mortarWaterCost) + (rebarLength * rebarCost) + (connectorQuantity * connectorCost);
                accessoriesHtml = `
                    <p><strong>Mortar Cement:</strong> <span class="value">${mortarCementBags.toFixed(2)} bags</span></p>
                    <p><strong>Mortar Sand:</strong> <span class="value">${mortarSandTons.toFixed(2)} tons</span></p>
                    <p><strong>Mortar Water:</strong> <span class="value">${mortarWater.toFixed(2)} m³</span></p>
                    <p><strong>Rebar:</strong> <span class="value">${rebarLength.toFixed(2)} m</span></p>
                    <p><strong>Connectors:</strong> <span class="value">${connectorQuantity.toFixed(2)} pcs</span></p>
                `;
            }
            totalAccessoryCost += accessoriesCost;
            materialResultsHtml += `
                <h4>${config.name} (Layer ${materialId})</h4>
                <p><strong>Quantity:</strong> <span class="value">${materialQuantity.toFixed(2)} ${config.unit}</span></p>
                <p><strong>Cost:</strong> <span class="value">${currencySymbol}${materialCost.toFixed(2)}</span></p>
                <h5>Accessories:</h5>
                ${accessoriesHtml}
            `;
        });
        // Plastering calculation
        let plasteringCost = 0;
        let plasteringArea = 0;
        let plasteringResultsHtml = '';
        if (plasterSide1 || plasterSide2) {
            plasteringArea = wallArea * (plasterSide1 + plasterSide2);
            const plasterCementBags = Math.ceil(plasteringArea * 0.01 * 0.25 / 0.025 * (1 + 0.1));
            const plasterSandTons = plasteringArea * 0.01 * 0.75 * 1.6 * (1 + 0.1);
            const plasterWater = plasteringArea * 0.01 * 0.5;
            plasteringCost = (plasterCementBags * plasteringCementCost) + (plasterSandTons * plasteringSandCost) + (plasterWater * plasteringWaterCost);
            plasteringResultsHtml = `
                <p><strong>Plastering Area:</strong> <span class="value">${plasteringArea.toFixed(2)} m²</span></p>
                <p><strong>Plaster Cement:</strong> <span class="value">${plasterCementBags.toFixed(2)} bags</span></p>
                <p><strong>Plaster Sand:</strong> <span class="value">${plasterSandTons.toFixed(2)} tons</span></p>
                <p><strong>Plaster Water:</strong> <span class="value">${plasterWater.toFixed(2)} m³</span></p>
            `;
        }
        // Labor calculations
        const avgProductivityRate = totalProductivityRate > 0 ? totalProductivityRate / document.querySelectorAll('.material-card').length : 0;
        const installationDays = wallArea / avgProductivityRate;
        const totalDays = (prepTime + installationDays + cleanupTime) / laborers;
        const laborCost = wallArea * laborCostPerSqm;
        // Cost summary
        const baseCosts = totalMaterialCost + totalAccessoryCost + plasteringCost + laborCost;
        const contingencyCost = baseCosts * (contingency / 100);
        const overheadCost = baseCosts * (overheadPercent / 100);
        const equipmentCost = baseCosts * (equipmentPercent / 100);
        const profitCost = (baseCosts + contingencyCost + overheadCost + equipmentCost) * (profitMargin / 100);
        const totalCost = baseCosts + contingencyCost + overheadCost + equipmentCost + profitCost;
        // Update results
        document.getElementById('wallLengthResult').textContent = `${length.toFixed(2)} m`;
        document.getElementById('wallHeightResult').textContent = `${height.toFixed(2)} m`;
        document.getElementById('doorAreaResult').textContent = `${doorArea.toFixed(2)} m²`;
        document.getElementById('windowAreaResult').textContent = `${windowArea.toFixed(2)} m²`;
        document.getElementById('wallArea').textContent = `${wallArea.toFixed(2)} m²`;
        document.getElementById('materialResults').innerHTML = materialResultsHtml;
        document.getElementById('plasteringResultsContainer').innerHTML = `
            <h3>Plastering Materials</h3>
            ${plasteringResultsHtml}
        `;
        document.getElementById('laborersResult').textContent = laborers;
        document.getElementById('productivityRate').textContent = `${avgProductivityRate.toFixed(2)} m²/day`;
        document.getElementById('prepTimeResult').textContent = `${prepTime.toFixed(2)} days`;
        document.getElementById('installTime').textContent = `${installationDays.toFixed(2)} days`;
        document.getElementById('cleanupTimeResult').textContent = `${cleanupTime.toFixed(2)} days`;
        document.getElementById('totalDays').textContent = `${totalDays.toFixed(2)} days`;
        // Update cost summary table
        document.getElementById('materialCostResult').textContent = totalMaterialCost.toFixed(2);
        document.getElementById('materialCostSqm').textContent = safeDivide(totalMaterialCost, wallArea);
        document.getElementById('accessoryCostResult').textContent = totalAccessoryCost.toFixed(2);
        document.getElementById('accessoryCostSqm').textContent = safeDivide(totalAccessoryCost, wallArea);
        document.getElementById('plasteringCostResult').textContent = plasteringCost.toFixed(2);
        document.getElementById('plasteringCostSqm').textContent = safeDivide(plasteringCost, wallArea);
        document.getElementById('laborCostResult').textContent = laborCost.toFixed(2);
        document.getElementById('laborCostSqm').textContent = safeDivide(laborCost, wallArea);
        document.getElementById('contingencyCostResult').textContent = contingencyCost.toFixed(2);
        document.getElementById('contingencyCostSqm').textContent = safeDivide(contingencyCost, wallArea);
        document.getElementById('overheadCostResult').textContent = overheadCost.toFixed(2);
        document.getElementById('overheadCostSqm').textContent = safeDivide(overheadCost, wallArea);
        document.getElementById('equipmentCostResult').textContent = equipmentCost.toFixed(2);
        document.getElementById('equipmentCostSqm').textContent = safeDivide(equipmentCost, wallArea);
        document.getElementById('profitCostResult').textContent = profitCost.toFixed(2);
        document.getElementById('profitCostSqm').textContent = safeDivide(profitCost, wallArea);
        document.getElementById('totalCost').textContent = totalCost.toFixed(2);
        document.getElementById('totalCostSqm').textContent = safeDivide(totalCost, wallArea);
        // Show results
        resultsDiv.style.display = 'block';
        messageDiv.className = 'success';
        messageDiv.textContent = 'Calculation complete!';
        window.scrollTo(0, resultsDiv.offsetTop);
    }
    // Added helper function to get currency symbol
    function getCurrencySymbol(currency) {
        switch (currency) {
            case 'PHP':
                return '₱';
            case 'USD':
                return '$';
            case 'EUR':
                return '€';
            case 'JPY':
                return '¥';
            default:
                return '';
        }
    }
    // Added helper function to show errors
    function displayError(message) {
        const messageDiv = document.getElementById('message');
        messageDiv.className = 'error';
        messageDiv.textContent = message;
        document.getElementById('results').style.display = 'block';
        }

        function calculateResults(event) {
            event.preventDefault();
            console.log('Calculate button clicked');

            const form = document.getElementById('calculatorForm');
            if (!form) {
                console.error('Form element not found');
                displayError('Internal error: Form not found');
                return;
            }

            const lengthInput = document.getElementById('length');
            const heightInput = document.getElementById('height');
            const doorAreaInput = document.getElementById('doorArea');
            const windowAreaInput = document.getElementById('windowArea');
            const prepTimeInput = document.getElementById('prepTime');
            const cleanupTimeInput = document.getElementById('cleanupTime');
            const overheadPercentInput = document.getElementById('overheadPercent');
            const equipmentPercentInput = document.getElementById('equipmentPercent');
            const profitMarginInput = document.getElementById('profitMargin');

            const wallLength = parseFloat(lengthInput.value) || 0;
            const wallHeight = parseFloat(heightInput.value) || 0;
            const doorArea = parseFloat(doorAreaInput.value) || 0;
            const windowArea = parseFloat(windowAreaInput.value) || 0;
            const plasterSide1 = document.getElementById('plasterSide1').checked;
            const plasterSide2 = document.getElementById('plasterSide2').checked;
            const plasterThickness = parseFloat(document.getElementById('plasterThickness').value) || 10;
            const currency = document.getElementById('currency').value;
            const studCost = parseFloat(document.getElementById('studCost').value) || 0;
            const trackCost = parseFloat(document.getElementById('trackCost').value) || 0;
            const screwCost = parseFloat(document.getElementById('screwCost').value) || 0;
            const jointCompoundCost = parseFloat(document.getElementById('jointCompoundCost').value) || 0;
            const sealantCost = parseFloat(document.getElementById('sealantCost').value) || 0;
            const rebarCost = parseFloat(document.getElementById('rebarCost').value) || 0;
            const connectorCost = parseFloat(document.getElementById('connectorCost').value) || 0;
            const mortarCementCost = parseFloat(document.getElementById('mortarCementCost').value) || 0;
            const mortarSandCost = parseFloat(document.getElementById('mortarSandCost').value) || 0;
            const mortarWaterCost = parseFloat(document.getElementById('mortarWaterCost').value) || 0;
            const plasterCementCost = parseFloat(document.getElementById('plasterCementCost').value) || 0;
            const plasterSandCost = parseFloat(document.getElementById('plasterSandCost').value) || 0;
            const plasterWaterCost = parseFloat(document.getElementById('plasterWaterCost').value) || 0;
            const laborCostPerSqM = parseFloat(document.getElementById('laborCost').value) || 0;
            const numberOfLaborers = parseInt(document.getElementById('laborers').value) || 1;
            const contingencyPercent = parseFloat(document.getElementById('contingency').value) / 100 || 0;
            const prepTime = parseFloat(prepTimeInput.value) || 0.5;
            const cleanupTime = parseFloat(cleanupTimeInput.value) || 0.5;
            const overheadPercent = parseFloat(overheadPercentInput.value) / 100 || 0;
            const equipmentPercent = parseFloat(equipmentPercentInput.value) / 100 || 0;
            const profitMargin = parseFloat(profitMarginInput.value) / 100 || 0;

            // Validation checks
            if (wallLength <= 0 || wallHeight <= 0 || wallLength + wallHeight <= 0.01) {
                displayError('Please enter valid wall dimensions (greater than 0).');
                return;
            }
            if (doorArea < 0 || windowArea < 0) {
                displayError('Door and window areas cannot be negative.');
                return;
            }
            if (prepTime < 0 || cleanupTime < 0) {
                displayError('Preparation and cleanup times cannot be negative.');
                return;
            }
            if (overheadPercent < 0 || equipmentPercent < 0 || profitMargin < 0 || overheadPercent > 1 || equipmentPercent > 1 || profitMargin > 1) {
                displayError('Overhead, equipment, and profit percentages must be between 0 and 100%.');
                return;
            }
            if (studCost < 0 || trackCost < 0 || screwCost < 0 || jointCompoundCost < 0 || sealantCost < 0 || rebarCost < 0 || connectorCost < 0 || mortarCementCost < 0 || mortarSandCost < 0 || mortarWaterCost < 0 || plasterCementCost < 0 || plasterSandCost < 0 || plasterWaterCost < 0 || laborCostPerSqM < 0) {
                displayError('Costs cannot be negative.');
                return;
            }

            const wallArea = (wallLength * wallHeight) - (doorArea + windowArea);
            if (wallArea <= 0) {
                displayError('Wall area cannot be zero or negative after subtracting openings.');
                return;
            }

            let totalMaterialCost = 0;
            let totalAccessoryCost = 0;
            let totalPlasteringCost = 0;
            let totalPlies = 0;
            let totalProductivityRate = 0;
            let mainMaterialResults = {};
            let accessoryResults = {};
            let plasteringResults = {};
            const materialCards = document.querySelectorAll('.material-card');

            if (materialCards.length === 0) {
                displayError('Please add at least one material layer.');
                return;
            }

            let validMaterials = true;
            materialCards.forEach(card => {
                const id = card.id.split('-')[2];
                const materialType = document.getElementById(`materialType${id}`).value;
                const materialCost = parseFloat(document.getElementById(`materialCost${id}`).value);
                const wasteFactor = parseFloat(document.getElementById(`wasteFactor${id}`).value) / 100 || 0;
                const config = materialConfig[materialType];
                const side1 = config.isFramedWall ? document.getElementById(`side1${id}`).checked : true;
                const side2 = config.isFramedWall ? document.getElementById(`side2${id}`).checked : false;
                const pliesSide1 = config.isFramedWall && side1 ? parseInt(document.getElementById(`pliesSide1${id}`).value) || 1 : 1;
                const pliesSide2 = config.isFramedWall && side2 ? parseInt(document.getElementById(`pliesSide2${id}`).value) || 1 : 1;

                if (materialCost < 0 || wasteFactor < 0 || wasteFactor > 1) {
                    displayError(`Invalid input for ${config.name}: cost or waste factor must be non-negative and waste factor below 100%.`);
                    validMaterials = false;
                    return;
                }

                const unitArea = config.unitArea;
                let materialQuantity = 0;
                if (side1) materialQuantity += Math.ceil((wallArea / unitArea) * pliesSide1);
                if (side2) materialQuantity += Math.ceil((wallArea / unitArea) * pliesSide2);
                materialQuantity = Math.ceil(materialQuantity * (1 + wasteFactor));
                const currentMaterialCost = materialQuantity * materialCost;
                totalMaterialCost += currentMaterialCost;

                if (!mainMaterialResults[config.name]) mainMaterialResults[config.name] = { quantity: 0, cost: 0, unit: config.unit };
                mainMaterialResults[config.name].quantity += materialQuantity;
                mainMaterialResults[config.name].cost += currentMaterialCost;

                if (config.isFramedWall) totalPlies += (side1 ? pliesSide1 : 0) + (side2 ? pliesSide2 : 0);
                if (config.productivityRate) totalProductivityRate += config.productivityRate * ((side1 ? pliesSide1 : 0) + (side2 ? pliesSide2 : 0));

                if (config.accessories.connectors) {
                    const connectors = Math.ceil(wallArea / 2);
                    accessoryResults['Connectors'] = { quantity: connectors, cost: connectors * connectorCost, unit: 'pieces' };
                    totalAccessoryCost += connectors * connectorCost;
                }
                if (config.accessories.sealants) {
                    const sealant = wallLength * 0.1;
                    accessoryResults['Sealant'] = { quantity: sealant, cost: sealant * sealantCost, unit: 'tubes' };
                    totalAccessoryCost += sealant * sealantCost;
                }
            });

            if (!validMaterials) return;

            const totalFramedWallPlies = totalPlies;
            if (totalFramedWallPlies > 0) {
                const studs = Math.ceil((wallLength / 0.6) * wallHeight * totalFramedWallPlies);
                const tracks = Math.ceil(2 * wallLength * totalFramedWallPlies);
                const screws = Math.ceil(wallArea * 25 * totalFramedWallPlies);
                const jointCompound = wallArea * 0.5 * totalFramedWallPlies;

                accessoryResults['Studs'] = { quantity: studs, cost: studs * studCost, unit: 'm' };
                accessoryResults['Tracks'] = { quantity: tracks, cost: tracks * trackCost, unit: 'm' };
                accessoryResults['Screws'] = { quantity: screws, cost: screws * screwCost, unit: 'pieces' };
                accessoryResults['Joint Compound'] = { quantity: jointCompound, cost: jointCompound * jointCompoundCost, unit: 'kg' };
                totalAccessoryCost += (studs * studCost) + (tracks * trackCost) + (screws * screwCost) + (jointCompound * jointCompoundCost);
            }

            const isMasonry = Array.from(materialCards).some(card => {
                const materialType = document.getElementById(`materialType${card.id.split('-')[2]}`).value;
                return materialType === 'chb' || materialType === 'aac';
            });
            if (isMasonry) {
                const mortarVolume = wallArea * 0.01;
                const mortarCementBags = Math.ceil((mortarVolume * 0.25) / 0.025 * (1 + (document.getElementById(`wasteFactor${materialCount}`).value / 100 || 0.1)));
                const mortarSandCubicMeters = mortarVolume * 0.75 * (1 + (document.getElementById(`wasteFactor${materialCount}`).value / 100 || 0.1));
                               const mortarWater = mortarVolume * 0.5;
                const rebarLength = wallArea * 0.1; // 10% coverage

                accessoryResults['Mortar Cement'] = { quantity: mortarCementBags, cost: mortarCementBags * mortarCementCost, unit: 'bags' };
                accessoryResults['Mortar Sand'] = { quantity: mortarSandCubicMeters, cost: mortarSandCubicMeters * mortarSandCost, unit: 'm³' };
                accessoryResults['Mortar Water'] = { quantity: mortarWater, cost: mortarWater * mortarWaterCost, unit: 'm³' };
                accessoryResults['Rebar'] = { quantity: rebarLength, cost: rebarLength * rebarCost, unit: 'm' };

                totalAccessoryCost += (mortarCementBags * mortarCementCost) + (mortarSandCubicMeters * mortarSandCost) + (mortarWater * mortarWaterCost) + (rebarLength * rebarCost);
            }

            let plasteringArea = 0;
            if (plasterSide1) plasteringArea += wallArea;
            if (plasterSide2) plasteringArea += wallArea;

            if (plasteringArea > 0 && !isNaN(plasterThickness)) {
                const plasterVolume = plasteringArea * (plasterThickness / 1000);
                const plasterCementBags = Math.ceil((plasterVolume * 0.25) / 0.025);
                const plasterSandCubicMeters = plasterVolume * 0.75;
                const plasterWater = plasterVolume * 0.5;

                plasteringResults['Plaster Cement'] = { quantity: plasterCementBags, cost: plasterCementBags * plasterCementCost, unit: 'bags' };
                plasteringResults['Plaster Sand'] = { quantity: plasterSandCubicMeters, cost: plasterSandCubicMeters * plasterSandCost, unit: 'm³' };
                plasteringResults['Plaster Water'] = { quantity: plasterWater, cost: plasterWater * plasterWaterCost, unit: 'm³' };

                totalPlasteringCost = (plasterCementBags * plasterCementCost) + (plasterSandCubicMeters * plasterSandCost) + (plasterWater * plasterWaterCost);
            }

            const laborCost = wallArea * laborCostPerSqM;
            const baseProjectCost = totalMaterialCost + totalAccessoryCost + totalPlasteringCost + laborCost;
            const contingencyCost = baseProjectCost * contingencyPercent;
            const overheadCost = baseProjectCost * overheadPercent;
            const equipmentCost = baseProjectCost * equipmentPercent;
            const profitCost = (baseProjectCost + contingencyCost + overheadCost + equipmentCost) * profitMargin;
            const grandTotalCost = baseProjectCost + contingencyCost + overheadCost + equipmentCost + profitCost;

            const installationDays = totalProductivityRate > 0 ? (wallArea / totalProductivityRate) : 0;
            const totalDays = (prepTime + installationDays + cleanupTime) / numberOfLaborers;

            window.resultsData = {
                projectName: document.getElementById('projectName').value,
                projectLocation: document.getElementById('projectLocation').value,
                clientName: document.getElementById('clientName').value,
                companyName: document.getElementById('companyName').value,
                date: document.getElementById('date').value,
                preparedBy: document.getElementById('preparedBy').value,
                wallLength: wallLength,
                wallHeight: wallHeight,
                wallArea: wallArea,
                doorArea: doorArea,
                windowArea: windowArea,
                plasterSide1: plasterSide1,
                plasterSide2: plasterSide2,
                plasterThickness: plasterThickness,
                currency: currency,
                currencySymbol: getCurrencySymbol(currency),
                materials: mainMaterialResults,
                accessories: accessoryResults,
                plastering: plasteringResults,
                laborCost: laborCost,
                contingency: contingencyCost,
                overhead: overheadCost,
                equipment: equipmentCost,
                profit: profitCost,
                totalCost: grandTotalCost,
                laborers: numberOfLaborers,
                productivityRate: totalProductivityRate.toFixed(2),
                prepTime: prepTime,
                installTime: installationDays.toFixed(2),
                cleanupTime: cleanupTime,
                totalDays: totalDays.toFixed(2),
                materialCost: totalMaterialCost,
                accessoryCost: totalAccessoryCost,
                plasteringCost: totalPlasteringCost
            };

            console.log('Global resultsData set:', window.resultsData);
            displayResults();
        }

        function displayResults() {
            console.log('Displaying results');
            if (!window.resultsData) {
                console.error('resultsData is not defined');
                return;
            }

            const resultsData = window.resultsData;
            const resultsDiv = document.getElementById('results');
            resultsDiv.style.display = 'block';
            document.getElementById('message').className = 'success';
            document.getElementById('message').textContent = 'Calculation successful!';

            document.getElementById('wallLengthResult').textContent = `${resultsData.wallLength.toFixed(2)} m`;
            document.getElementById('wallHeightResult').textContent = `${resultsData.wallHeight.toFixed(2)} m`;
            document.getElementById('doorAreaResult').textContent = `${resultsData.doorArea.toFixed(2)} m²`;
            document.getElementById('windowAreaResult').textContent = `${resultsData.windowArea.toFixed(2)} m²`;
            document.getElementById('wallArea').textContent = `${resultsData.wallArea.toFixed(2)} m²`;

            document.getElementById('laborersResult').textContent = resultsData.laborers;
            document.getElementById('productivityRate').textContent = `${resultsData.productivityRate} m²/day`;
            document.getElementById('prepTimeResult').textContent = `${resultsData.prepTime} days`;
            document.getElementById('installTime').textContent = `${resultsData.installTime} days`;
            document.getElementById('cleanupTimeResult').textContent = `${resultsData.cleanupTime} days`;
            document.getElementById('totalDays').textContent = `${resultsData.totalDays} days`;

            const currencySymbol = resultsData.currencySymbol;
            const wallArea = resultsData.wallArea;

            document.getElementById('currencySymbolMaterial').textContent = currencySymbol;
            document.getElementById('materialCostResult').textContent = resultsData.materialCost.toFixed(2);
            document.getElementById('currencySymbolMaterialSqm').textContent = currencySymbol;
            document.getElementById('materialCostSqm').textContent = wallArea > 0 ? (resultsData.materialCost / wallArea).toFixed(2) : '0.00';

            document.getElementById('currencySymbolAccessory').textContent = currencySymbol;
            document.getElementById('accessoryCostResult').textContent = resultsData.accessoryCost.toFixed(2);
            document.getElementById('currencySymbolAccessorySqm').textContent = currencySymbol;
            document.getElementById('accessoryCostSqm').textContent = wallArea > 0 ? (resultsData.accessoryCost / wallArea).toFixed(2) : '0.00';

            document.getElementById('currencySymbolPlaster').textContent = currencySymbol;
            document.getElementById('plasteringCostResult').textContent = resultsData.plasteringCost.toFixed(2);
            document.getElementById('currencySymbolPlasterSqm').textContent = currencySymbol;
            document.getElementById('plasteringCostSqm').textContent = wallArea > 0 ? (resultsData.plasteringCost / wallArea).toFixed(2) : '0.00';

            document.getElementById('currencySymbolLabor').textContent = currencySymbol;
            document.getElementById('laborCostResult').textContent = resultsData.laborCost.toFixed(2);
            document.getElementById('currencySymbolLaborSqm').textContent = currencySymbol;
            document.getElementById('laborCostSqm').textContent = wallArea > 0 ? (resultsData.laborCost / wallArea).toFixed(2) : '0.00';

            document.getElementById('currencySymbolContingency').textContent = currencySymbol;
            document.getElementById('contingencyCostResult').textContent = resultsData.contingency.toFixed(2);
            document.getElementById('currencySymbolContingencySqm').textContent = currencySymbol;
            document.getElementById('contingencyCostSqm').textContent = wallArea > 0 ? (resultsData.contingency / wallArea).toFixed(2) : '0.00';

            document.getElementById('currencySymbolOverhead').textContent = currencySymbol;
            document.getElementById('overheadCostResult').textContent = resultsData.overhead.toFixed(2);
            document.getElementById('currencySymbolOverheadSqm').textContent = currencySymbol;
            document.getElementById('overheadCostSqm').textContent = wallArea > 0 ? (resultsData.overhead / wallArea).toFixed(2) : '0.00';

            document.getElementById('currencySymbolEquipment').textContent = currencySymbol;
            document.getElementById('equipmentCostResult').textContent = resultsData.equipment.toFixed(2);
            document.getElementById('currencySymbolEquipmentSqm').textContent = currencySymbol;
            document.getElementById('equipmentCostSqm').textContent = wallArea > 0 ? (resultsData.equipment / wallArea).toFixed(2) : '0.00';

            document.getElementById('currencySymbolProfit').textContent = currencySymbol;
            document.getElementById('profitCostResult').textContent = resultsData.profit.toFixed(2);
            document.getElementById('currencySymbolProfitSqm').textContent = currencySymbol;
            document.getElementById('profitCostSqm').textContent = wallArea > 0 ? (resultsData.profit / wallArea).toFixed(2) : '0.00';

            document.getElementById('currencySymbolTotal').textContent = currencySymbol;
            document.getElementById('totalCost').textContent = resultsData.totalCost.toFixed(2);
            document.getElementById('currencySymbolTotalSqm').textContent = currencySymbol;
            document.getElementById('totalCostSqm').textContent = wallArea > 0 ? (resultsData.totalCost / wallArea).toFixed(2) : '0.00';

            const materialResultsDiv = document.getElementById('materialResults');
            materialResultsDiv.innerHTML = '';
            for (const [name, data] of Object.entries(resultsData.materials)) {
                materialResultsDiv.innerHTML += `
                    <p><strong>${name} Quantity:</strong> <span class="value">${data.quantity} ${data.unit}</span></p>
                    <p><strong>${name} Cost:</strong> <span class="value">${currencySymbol}${data.cost.toFixed(2)}</span></p>
                `;
            }

            const accessoryResultsDiv = document.getElementById('accessoryResults');
            accessoryResultsDiv.innerHTML = '';
            for (const [name, data] of Object.entries(resultsData.accessories)) {
                accessoryResultsDiv.innerHTML += `
                    <p><strong>${name} Quantity:</strong> <span class="value">${data.quantity.toFixed(2)} ${data.unit}</span></p>
                    <p><strong>${name} Cost:</strong> <span class="value">${currencySymbol}${data.cost.toFixed(2)}</span></p>
                `;
            }

            const plasteringResultsDiv = document.getElementById('plasteringResults');
            plasteringResultsDiv.innerHTML = '';
            if (Object.keys(resultsData.plastering).length > 0) {
                document.getElementById('plasteringResultsContainer').style.display = 'block';
                for (const [name, data] of Object.entries(resultsData.plastering)) {
                    plasteringResultsDiv.innerHTML += `
                        <p><strong>${name} Quantity:</strong> <span class="value">${data.quantity.toFixed(2)} ${data.unit}</span></p>
                        <p><strong>${name} Cost:</strong> <span class="value">${currencySymbol}${data.cost.toFixed(2)}</span></p>
                    `;
                }
            } else {
                document.getElementById('plasteringResultsContainer').style.display = 'none';
            }
        }

        function downloadPDF() {
            console.log('Download PDF button clicked');
            if (!window.resultsData) {
                alert("Please calculate the results first.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFont('Arial', 'bold');
            doc.setFontSize(12);
            doc.text("Wall Materials Calculation Summary", 14, 22);

            const projectInfoData = getProjectInfoData();
            const wallParametersData = getWallParametersData();
            const materialData = getMaterialTableData();
            const accessoryData = getAccessoryTableData();
            const costSummaryData = getCostSummaryData();

            doc.autoTable({
                startY: 30,
                head: [[{ content: 'Project Information', colSpan: 2, styles: { fontStyle: 'bold', halign: 'center', font: 'Arial', fontSize: 10 } }],
                body: projectInfoData,
                theme: 'plain',
                styles: { font: 'Arial', fontSize: 10, cellPadding: 2 },
                headStyles: { fillColor: [44, 62, 80], textColor: [255, 255, 255] },
                columnStyles: { 0: { fontStyle: 'bold', minWidth: 50 } }
            });

            doc.autoTable({
                startY: doc.autoTable.previous.finalY + 10,
                head: [[{ content: 'Wall Parameters', colSpan: 2, styles: { fontStyle: 'bold', halign: 'center', font: 'Arial', fontSize: 10 } }],
                body: wallParametersData,
                theme: 'plain',
                styles: { font: 'Arial', fontSize: 10, cellPadding: 2 },
                headStyles: { fillColor: [44, 62, 80], textColor: [255, 255, 255] },
                columnStyles: { 0: { fontStyle: 'bold', minWidth: 50 } }
            });

            if (materialData.length > 0) {
                doc.autoTable({
                    startY: doc.autoTable.previous.finalY + 10,
                    head: [[{ content: 'Material Layers', colSpan: 3, styles: { fontStyle: 'bold', halign: 'center', font: 'Arial', fontSize: 10 } }],
                    body: materialData,
                    theme: 'plain',
                    styles: { font: 'Arial', fontSize: 10, cellPadding: 2 },
                    headStyles: { fillColor: [44, 62, 80], textColor: [255, 255, 255] },
                    columnStyles: { 0: { fontStyle: 'bold', minWidth: 50 } }
                });
            }

            if (accessoryData.length > 0) {
                doc.autoTable({
                    startY: doc.autoTable.previous.finalY + 10,
                    head: [[{ content: 'Accessory Materials', colSpan: 3, styles: { fontStyle: 'bold', halign: 'center', font: 'Arial', fontSize: 10 } }],
                    body: accessoryData,
                    theme: 'plain',
                    styles: { font: 'Arial', fontSize: 10, cellPadding: 2 },
                    headStyles: { fillColor: [44, 62, 80], textColor: [255, 255, 255] },
                    columnStyles: { 0: { fontStyle: 'bold', minWidth: 50 } }
                });
            }

            doc.autoTable({
                startY: doc.autoTable.previous.finalY + 10,
                head: [[{ content: 'Cost Summary', colSpan: 3, styles: { fontStyle: 'bold', halign: 'center', font: 'Arial', fontSize: 10 } }],
                body: costSummaryData,
                theme: 'plain',
                headStyles: { fillColor: [44, 62, 80], textColor: [255, 255, 255] },
                styles: { font: 'Arial', fontSize: 10, cellPadding: 2 }
            });

            doc.save("Wall Materials Calculation_Summary.pdf");
        }

        function getProjectInfoData() {
            const { projectName, projectLocation, clientName, date, preparedBy } = window.resultsData;
            return [
                ['Project Name:', projectName || 'N/A'],
                ['Project Location:', projectLocation || 'N/A'],
                ['Client Name:', clientName || 'N/A'],
                ['Date:', date || 'N/A'],
                ['Prepared By:', preparedBy || 'N/A']
            ];
        }

        function getWallParametersData() {
            const { wallLength, wallHeight, wallArea, doorArea, windowArea } = window.resultsData;
            return [
                ['Length:', `${wallLength.toFixed(2)} m`],
                ['Height:', `${wallHeight.toFixed(2)} m`],
                ['Door Area:', `${doorArea.toFixed(2)} m²`],
                ['Window Area:', `${windowArea.toFixed(2)} m²`],
                ['Wall Area:', `${wallArea.toFixed(2)} m²`]
            ];
        }

        function getMaterialTableData() {
            const materials = [];
            for (const [name, data] of Object.entries(window.resultsData.materials || {})) {
                materials.push([name, `${data.quantity} ${data.unit}`, `${window.resultsData.currencySymbol}${data.cost.toFixed(2)}`]);
            }
            return materials.length > 0 ? materials : [['No Materials', '', '0.00']];
        }

        function getAccessoryTableData() {
            const accessories = [];
            for (const [name, data] of Object.entries(window.resultsData.accessories || {})) {
                accessories.push([name, `${data.quantity.toFixed(2)} ${data.unit}`, `${window.resultsData.currencySymbol}${data.cost.toFixed(2)}`]);
            }
            return accessories.length > 0 ? accessories : [['No Accessories', '', '0.00']];
        }

        function getCostSummaryData() {
            const { currencySymbol, materialCost, accessoryCost, plasteringCost, laborCost, contingency, overhead, equipment, profit, totalCost, wallArea } = window.resultsData;
            const safeDivide = (value, divisor) => !isNaN(parseFloat(value)) && parseFloat(divisor) > 0 ? (parseFloat(value) / parseFloat(divisor)).toFixed(2) : '0.00';
            return [
                ['Main Material Cost', `${currencySymbol}${materialCost.toFixed(2)}`, `${currencySymbol}${safeDivide(materialCost, wallArea)}/m²`],
                ['Accessory Cost', `${currencySymbol}${accessoryCost.toFixed(2)}`, `${currencySymbol}${safeDivide(accessoryCost, wallArea)}/m²`],
                ['Plastering Cost', `${currencySymbol}${plasteringCost.toFixed(2)}`, `${currencySymbol}${safeDivide(plasteringCost, wallArea)}/m²`],
                ['Labor Cost', `${currencySymbol}${laborCost.toFixed(2)}`, `${currencySymbol}${safeDivide(laborCost, wallArea)}/m²`],
                ['Contingency Cost', `${currencySymbol}${contingency.toFixed(2)}`, `${currencySymbol}${safeDivide(contingency, wallArea)}/m²`],
                ['Overhead Cost', `${currencySymbol}${overhead.toFixed(2)}`, `${currencySymbol}${safeDivide(overhead, wallArea)}/m²`],
                ['Equipment Cost', `${currencySymbol}${equipment.toFixed(2)}`, `${currencySymbol}${safeDivide(equipment, wallArea)}/m²`],
                ['Profit Cost', `${currencySymbol}${profit.toFixed(2)}`, `${currencySymbol}${safeDivide(profit, wallArea)}/m²`],
                ['Total Cost', `${currencySymbol}${totalCost.toFixed(2)}`, `${currencySymbol}${safeDivide(totalCost, wallArea)}/m²`]
            ];
        }

        function getCurrencySymbol(currency) {
            switch (currency) {
                case 'PHP': return '₱';
                case 'USD': return '$';
                case 'EUR': return '€';
                case 'JPY': return '¥';
                default: return '';
            }
        }
    </script>
</body>
</html>
